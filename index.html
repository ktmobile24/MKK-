<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8" /&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1">&lt;title&gt;MKK Investment Tracker — Code Bundle (index.html)&lt;/title&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">    </span>--bg:#0f172a;--card:#111827;--soft:#0b1220;--text:#e5e7eb;--muted:#9ca3af;--line:#1f2937;--accent:#60a5fa</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">  </span>body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}</p>
<p class="p1"><span class="Apple-converted-space">  </span>header{display:flex;align-items:center;gap:14px;padding:16px 22px;background:linear-gradient(90deg,#0b1220,#111827,#0b1220);border-bottom:1px solid var(--line)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>h1{margin:0;font-size:22px;letter-spacing:.3px;background:linear-gradient(180deg,#e5e7eb,#94a3b8,#e5e7eb);-webkit-background-clip:text;background-clip:text;color:transparent}</p>
<p class="p1"><span class="Apple-converted-space">  </span>main{max-width:1100px;margin:0 auto;padding:20px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px 18px;box-shadow:0 8px 22px rgba(0,0,0,.28)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.files{display:grid;gap:14px;margin-top:16px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.file{border:1px solid var(--line);border-radius:12px;overflow:hidden;background:var(--card)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.file header{display:flex;justify-content:space-between;align-items:center;background:var(--soft);border-bottom:1px solid var(--line);padding:10px 12px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.file h2{font-size:14px;margin:0;color:#e5e7eb}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn{appearance:none;border:1px solid #334155;background:#1f2937;color:#e5e7eb;border-radius:8px;padding:6px 10px;font-size:12px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn:hover{background:#263042}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.code{max-height:480px;overflow:auto;padding:0;margin:0;background:#0b1220}</p>
<p class="p1"><span class="Apple-converted-space">  </span>pre{margin:0}</p>
<p class="p1"><span class="Apple-converted-space">  </span>code{display:block;padding:14px;color:#e5e7eb;white-space:pre;line-height:1.45}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.muted{color:var(--muted)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.top-actions{display:flex;gap:10px;margin-top:10px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.badge{display:inline-block;padding:3px 8px;border:1px solid #334155;border-radius:999px;background:#121a2d;font-size:12px;color:#cbd5e1}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;h1&gt;MKK Investment Tracker — Embedded Code (save-as index.html)&lt;/h1&gt;</p>
<p class="p1">&lt;/header&gt;</p>
<p class="p1">&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;p&gt;This page contains all code as plain text. Click the &lt;b&gt;Download&lt;/b&gt; buttons to save each file, or copy directly from the code blocks.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="top-actions"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" onclick="downloadAll()"&gt;⬇️ Download all files&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;span class="badge"&gt;App version: 1.8.9c&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="files" id="files"&gt;&lt;/div&gt;</p>
<p class="p1">&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">/* ---------- File contents (edit as needed) ---------- */</p>
<p class="p2"><br></p>
<p class="p1">const FILES = [</p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "tracker_app.py",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/x-python",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`# MKK Investment Tracker — Streamlit App (v1.8.9c)</p>
<p class="p2"><br></p>
<p class="p1">import json, os, sys, shutil</p>
<p class="p1">from datetime import datetime, date</p>
<p class="p1">from typing import Dict, Any</p>
<p class="p1">import streamlit as st, yfinance as yf, pandas as pd, numpy as np</p>
<p class="p2"><br></p>
<p class="p1">APP_NAME = "MKK Investment Tracker"</p>
<p class="p1">APP_VERSION = "1.8.9c"</p>
<p class="p1">st.set_page_config(page_title=f"{APP_NAME} {APP_VERSION}", page_icon="💠", layout="wide")</p>
<p class="p2"><br></p>
<p class="p1"># ---------------- Data management ----------------</p>
<p class="p1">def running_in_cloud() -&gt; bool:</p>
<p class="p1"><span class="Apple-converted-space">    </span># Streamlit Cloud sets env keys; this is a light heuristic</p>
<p class="p1"><span class="Apple-converted-space">    </span>return bool(os.environ.get("STREAMLIT_RUNTIME"))</p>
<p class="p2"><br></p>
<p class="p1">def _data_path() -&gt; str:</p>
<p class="p1"><span class="Apple-converted-space">    </span>"""Choose a data path that works on Mac and Streamlit Cloud."""</p>
<p class="p1"><span class="Apple-converted-space">    </span>if running_in_cloud():</p>
<p class="p1"><span class="Apple-converted-space">        </span>base = os.path.join(os.getcwd(), "data")</p>
<p class="p1"><span class="Apple-converted-space">    </span>else:</p>
<p class="p1"><span class="Apple-converted-space">        </span>if sys.platform == "darwin":</p>
<p class="p1"><span class="Apple-converted-space">            </span>base = os.path.expanduser("~/Library/Application Support/MKK Investment Tracker")</p>
<p class="p1"><span class="Apple-converted-space">        </span>else:</p>
<p class="p1"><span class="Apple-converted-space">            </span>base = os.path.join(os.path.expanduser("~"), ".mkk_investment_tracker")</p>
<p class="p1"><span class="Apple-converted-space">    </span>os.makedirs(base, exist_ok=True)</p>
<p class="p1"><span class="Apple-converted-space">    </span>return os.path.join(base, "portfolio_data.json")</p>
<p class="p2"><br></p>
<p class="p1">DATA_FILE = _data_path()</p>
<p class="p2"><br></p>
<p class="p1">def load_data() -&gt; Dict[str, Any]:</p>
<p class="p1"><span class="Apple-converted-space">    </span>if not os.path.exists(DATA_FILE):</p>
<p class="p1"><span class="Apple-converted-space">        </span>return {</p>
<p class="p1"><span class="Apple-converted-space">            </span>"holdings": {},</p>
<p class="p1"><span class="Apple-converted-space">            </span>"cash_uninvested": 0.0,</p>
<p class="p1"><span class="Apple-converted-space">            </span>"settings": {"currency": "USD", "auto_price": True},</p>
<p class="p1"><span class="Apple-converted-space">            </span>"last_prices": {},</p>
<p class="p1"><span class="Apple-converted-space">            </span>"last_updated": None,</p>
<p class="p1"><span class="Apple-converted-space">            </span>"version": APP_VERSION,</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>with open(DATA_FILE, "r", encoding="utf-8") as f:</p>
<p class="p1"><span class="Apple-converted-space">        </span>d = json.load(f)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>d.setdefault("settings", {})</p>
<p class="p1"><span class="Apple-converted-space">    </span>d["settings"].setdefault("currency", "USD")</p>
<p class="p1"><span class="Apple-converted-space">    </span>d["settings"].setdefault("auto_price", True)</p>
<p class="p1"><span class="Apple-converted-space">    </span>d.setdefault("last_prices", {})</p>
<p class="p1"><span class="Apple-converted-space">    </span>d.setdefault("last_updated", None)</p>
<p class="p1"><span class="Apple-converted-space">    </span>d.setdefault("cash_uninvested", 0.0)</p>
<p class="p1"><span class="Apple-converted-space">    </span>d["version"] = APP_VERSION</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>for rec in d.get("holdings", {}).values():</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.setdefault("purchase_price", None)</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.setdefault("dividends_collected", 0.0)</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.setdefault("last_div_amount", 0.0)</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.setdefault("last_div_date", "")</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.setdefault("summary", "")</p>
<p class="p1"><span class="Apple-converted-space">    </span>return d</p>
<p class="p2"><br></p>
<p class="p1">def save_data(data: Dict[str, Any]) -&gt; None:</p>
<p class="p1"><span class="Apple-converted-space">    </span>with open(DATA_FILE, "w", encoding="utf-8") as f:</p>
<p class="p1"><span class="Apple-converted-space">        </span>json.dump(data, f, indent=2)</p>
<p class="p2"><br></p>
<p class="p1">DATA = load_data()</p>
<p class="p2"><br></p>
<p class="p1"># ---------------- Helpers ----------------</p>
<p class="p1">def money_to_float(text: str) -&gt; float:</p>
<p class="p1"><span class="Apple-converted-space">    </span>if text is None:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return 0.0</p>
<p class="p1"><span class="Apple-converted-space">    </span>s = str(text).strip().replace(",", "").replace("$", "")</p>
<p class="p1"><span class="Apple-converted-space">    </span>try:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return float(s) if s else 0.0</p>
<p class="p1"><span class="Apple-converted-space">    </span>except:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return 0.0</p>
<p class="p2"><br></p>
<p class="p1">def money_str(x: float) -&gt; str:</p>
<p class="p1"><span class="Apple-converted-space">    </span>if x is None or not np.isfinite(x):</p>
<p class="p1"><span class="Apple-converted-space">        </span>return ""</p>
<p class="p1"><span class="Apple-converted-space">    </span>return f"${x:,.2f}"</p>
<p class="p2"><br></p>
<p class="p1">def money_input(label: str, key: str, value: float = 0.0, help: str = "") -&gt; float:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.write(label)</p>
<p class="p1"><span class="Apple-converted-space">    </span>default = money_str(value)</p>
<p class="p1"><span class="Apple-converted-space">    </span>txt = st.text_input(</p>
<p class="p1"><span class="Apple-converted-space">        </span>label="",</p>
<p class="p1"><span class="Apple-converted-space">        </span>value=default,</p>
<p class="p1"><span class="Apple-converted-space">        </span>key=key,</p>
<p class="p1"><span class="Apple-converted-space">        </span>help=help,</p>
<p class="p1"><span class="Apple-converted-space">        </span>label_visibility="collapsed",</p>
<p class="p1"><span class="Apple-converted-space">        </span>placeholder="$0.00",</p>
<p class="p1"><span class="Apple-converted-space">    </span>)</p>
<p class="p1"><span class="Apple-converted-space">    </span>return money_to_float(txt)</p>
<p class="p2"><br></p>
<p class="p1">def shares_to_float(text: str) -&gt; float:</p>
<p class="p1"><span class="Apple-converted-space">    </span>if text is None:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return 0.0</p>
<p class="p1"><span class="Apple-converted-space">    </span>s = str(text).strip().replace(",", "").replace("\\u00a0", "").strip()</p>
<p class="p1"><span class="Apple-converted-space">    </span>try:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return float(s) if s else 0.0</p>
<p class="p1"><span class="Apple-converted-space">    </span>except:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return 0.0</p>
<p class="p2"><br></p>
<p class="p1">def shares_input(</p>
<p class="p1"><span class="Apple-converted-space">    </span>label: str,</p>
<p class="p1"><span class="Apple-converted-space">    </span>key: str,</p>
<p class="p1"><span class="Apple-converted-space">    </span>value: float = 0.0,</p>
<p class="p1"><span class="Apple-converted-space">    </span>help: str = "",</p>
<p class="p1"><span class="Apple-converted-space">    </span>placeholder: str = "0.000000",</p>
<p class="p1">) -&gt; float:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.write(label)</p>
<p class="p1"><span class="Apple-converted-space">    </span>txt = st.text_input(</p>
<p class="p1"><span class="Apple-converted-space">        </span>label="",</p>
<p class="p1"><span class="Apple-converted-space">        </span>value=f"{value:.6f}" if value else "",</p>
<p class="p1"><span class="Apple-converted-space">        </span>key=key,</p>
<p class="p1"><span class="Apple-converted-space">        </span>help=help,</p>
<p class="p1"><span class="Apple-converted-space">        </span>label_visibility="collapsed",</p>
<p class="p1"><span class="Apple-converted-space">        </span>placeholder=placeholder,</p>
<p class="p1"><span class="Apple-converted-space">    </span>)</p>
<p class="p1"><span class="Apple-converted-space">    </span>return shares_to_float(txt)</p>
<p class="p2"><br></p>
<p class="p1">@st.cache_data(show_spinner=False)</p>
<p class="p1">def fetch_price(ticker: str) -&gt; float:</p>
<p class="p1"><span class="Apple-converted-space">    </span>try:</p>
<p class="p1"><span class="Apple-converted-space">        </span>t = yf.Ticker(ticker)</p>
<p class="p1"><span class="Apple-converted-space">        </span>hist = t.history(period="5d", interval="1d")</p>
<p class="p1"><span class="Apple-converted-space">        </span>if hist is None or hist.empty:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return float("nan")</p>
<p class="p1"><span class="Apple-converted-space">        </span>return float(hist["Close"].dropna().iloc[-1])</p>
<p class="p1"><span class="Apple-converted-space">    </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return float("nan")</p>
<p class="p2"><br></p>
<p class="p1">@st.cache_data(show_spinner=False)</p>
<p class="p1">def fetch_name_and_summary(ticker: str):</p>
<p class="p1"><span class="Apple-converted-space">    </span>try:</p>
<p class="p1"><span class="Apple-converted-space">        </span>tk = yf.Ticker(ticker)</p>
<p class="p1"><span class="Apple-converted-space">        </span>info = tk.info or {}</p>
<p class="p1"><span class="Apple-converted-space">        </span>name = info.get("longName") or info.get("shortName") or info.get("symbol") or ticker</p>
<p class="p1"><span class="Apple-converted-space">        </span>summary = info.get("longBusinessSummary") or info.get("description") or ""</p>
<p class="p1"><span class="Apple-converted-space">        </span>if summary:</p>
<p class="p1"><span class="Apple-converted-space">            </span>summary = (summary[:500] + "…") if len(summary) &gt; 500 else summary</p>
<p class="p1"><span class="Apple-converted-space">        </span>return name, summary</p>
<p class="p1"><span class="Apple-converted-space">    </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return ticker, ""</p>
<p class="p2"><br></p>
<p class="p1">@st.cache_data(show_spinner=False)</p>
<p class="p1">def fetch_dividend_frequency(ticker: str) -&gt; str:</p>
<p class="p1"><span class="Apple-converted-space">    </span>try:</p>
<p class="p1"><span class="Apple-converted-space">        </span>t = yf.Ticker(ticker)</p>
<p class="p1"><span class="Apple-converted-space">        </span>div = t.dividends</p>
<p class="p1"><span class="Apple-converted-space">        </span>if div is None or len(div) &lt; 3:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Irregular/None"</p>
<p class="p1"><span class="Apple-converted-space">        </span>dates = pd.to_datetime(div.index).sort_values()</p>
<p class="p1"><span class="Apple-converted-space">        </span>cutoff = pd.Timestamp.utcnow() - pd.Timedelta(days=3 * 365)</p>
<p class="p1"><span class="Apple-converted-space">        </span>dates = dates[dates &gt;= cutoff]</p>
<p class="p1"><span class="Apple-converted-space">        </span>if len(dates) &lt; 3:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Irregular/None"</p>
<p class="p1"><span class="Apple-converted-space">        </span>diffs = (dates[1:] - dates[:-1]).days.values</p>
<p class="p1"><span class="Apple-converted-space">        </span>if len(diffs) == 0:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Irregular/None"</p>
<p class="p1"><span class="Apple-converted-space">        </span>med = float(np.median(diffs))</p>
<p class="p1"><span class="Apple-converted-space">        </span>if med &lt;= 9:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Weekly"</p>
<p class="p1"><span class="Apple-converted-space">        </span>if med &lt;= 45:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Monthly"</p>
<p class="p1"><span class="Apple-converted-space">        </span>if med &lt;= 115:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Quarterly"</p>
<p class="p1"><span class="Apple-converted-space">        </span>if med &lt;= 220:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Semiannual"</p>
<p class="p1"><span class="Apple-converted-space">        </span>if med &lt;= 400:</p>
<p class="p1"><span class="Apple-converted-space">            </span>return "Annual"</p>
<p class="p1"><span class="Apple-converted-space">        </span>return "Irregular/None"</p>
<p class="p1"><span class="Apple-converted-space">    </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return "Irregular/None"</p>
<p class="p2"><br></p>
<p class="p1"># ---------------- Sidebar ----------------</p>
<p class="p1">with st.sidebar:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("Settings")</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.caption(f"Version: **{APP_VERSION}**")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if st.button("Clear cached prices"):</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch_price.clear()</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch_name_and_summary.clear()</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch_dividend_frequency.clear()</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.success("Cleared cached data.")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>DATA["settings"]["currency"] = st.selectbox(</p>
<p class="p1"><span class="Apple-converted-space">        </span>"Currency",</p>
<p class="p1"><span class="Apple-converted-space">        </span>["USD", "EUR", "GBP", "JPY", "CAD"],</p>
<p class="p1"><span class="Apple-converted-space">        </span>index=["USD", "EUR", "GBP", "JPY", "CAD"].index(</p>
<p class="p1"><span class="Apple-converted-space">            </span>DATA["settings"].get("currency", "USD")</p>
<p class="p1"><span class="Apple-converted-space">        </span>),</p>
<p class="p1"><span class="Apple-converted-space">    </span>)</p>
<p class="p1"><span class="Apple-converted-space">    </span>DATA["settings"]["auto_price"] = st.checkbox(</p>
<p class="p1"><span class="Apple-converted-space">        </span>"Auto-update prices", value=DATA["settings"].get("auto_price", True)</p>
<p class="p1"><span class="Apple-converted-space">    </span>)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if st.button("🔄 Update all prices now"):</p>
<p class="p1"><span class="Apple-converted-space">        </span>updated = 0</p>
<p class="p1"><span class="Apple-converted-space">        </span>for tkr in DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">            </span>p = fetch_price(tkr)</p>
<p class="p1"><span class="Apple-converted-space">            </span>if np.isfinite(p):</p>
<p class="p1"><span class="Apple-converted-space">                </span>DATA["last_prices"][tkr] = p</p>
<p class="p1"><span class="Apple-converted-space">                </span>updated += 1</p>
<p class="p1"><span class="Apple-converted-space">        </span>DATA["last_updated"] = datetime.now().isoformat(timespec="seconds")</p>
<p class="p1"><span class="Apple-converted-space">        </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.success(f"Updated {updated} tickers.")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if st.button("💾 Save data"):</p>
<p class="p1"><span class="Apple-converted-space">        </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.success("Saved.")</p>
<p class="p2"><br></p>
<p class="p1"># ---------------- Tabs ----------------</p>
<p class="p1">st.title("MKK Investment Tracker")</p>
<p class="p1">tab_port, tab_add, tab_edit, tab_div, tab_trueada, tab_migrate, tab_backup = st.tabs(</p>
<p class="p1"><span class="Apple-converted-space">    </span>["Portfolio", "Add Holding", "Edit Holdings", "Dividends", "True ADA", "Migration", "Backup"]</p>
<p class="p1">)</p>
<p class="p2"><br></p>
<p class="p1">def stripe():</p>
<p class="p1"><span class="Apple-converted-space">    </span>return [{"selector": "tbody tr:nth-child(odd)", "props": "background-color: rgba(0,0,0,0.03);"}]</p>
<p class="p2"><br></p>
<p class="p1">def color_pos_neg(v):</p>
<p class="p1"><span class="Apple-converted-space">    </span>try:</p>
<p class="p1"><span class="Apple-converted-space">        </span>x = float(str(v).replace("%", "").replace(",", "").replace("$", ""))</p>
<p class="p1"><span class="Apple-converted-space">    </span>except:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return ""</p>
<p class="p1"><span class="Apple-converted-space">    </span>if not np.isfinite(x):</p>
<p class="p1"><span class="Apple-converted-space">        </span>return ""</p>
<p class="p1"><span class="Apple-converted-space">    </span>if x &gt; 0:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return "color:#16a34a;"</p>
<p class="p1"><span class="Apple-converted-space">    </span>if x &lt; 0:</p>
<p class="p1"><span class="Apple-converted-space">        </span>return "color:#dc2626;"</p>
<p class="p1"><span class="Apple-converted-space">    </span>return ""</p>
<p class="p2"><br></p>
<p class="p1">def money_fmt(v):</p>
<p class="p1"><span class="Apple-converted-space">    </span>return "" if pd.isna(v) else f"${float(v):,.2f}"</p>
<p class="p2"><br></p>
<p class="p1">def pct_fmt(v):</p>
<p class="p1"><span class="Apple-converted-space">    </span>return "" if pd.isna(v) else f"{float(v):,.2f}%"</p>
<p class="p2"><br></p>
<p class="p1"># ---- Portfolio ----</p>
<p class="p1">with tab_port:</p>
<p class="p1"><span class="Apple-converted-space">    </span>if not DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.info("No holdings yet.")</p>
<p class="p1"><span class="Apple-converted-space">    </span>else:</p>
<p class="p1"><span class="Apple-converted-space">        </span>rows = []</p>
<p class="p1"><span class="Apple-converted-space">        </span>total_invested = 0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>total_value = 0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>total_div = 0.0</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>for tkr, rec in sorted(DATA["holdings"].items()):</p>
<p class="p1"><span class="Apple-converted-space">            </span>shares = float(rec.get("shares", 0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>invested = float(rec.get("total_invested", 0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>price = fetch_price(tkr) if DATA["settings"].get("auto_price", True) else float("nan")</p>
<p class="p1"><span class="Apple-converted-space">            </span>if np.isnan(price):</p>
<p class="p1"><span class="Apple-converted-space">                </span>price = float(DATA["last_prices"].get(tkr, np.nan))</p>
<p class="p1"><span class="Apple-converted-space">            </span>mval = shares * price if np.isfinite(price) else np.nan</p>
<p class="p1"><span class="Apple-converted-space">            </span>divs = float(rec.get("dividends_collected", 0.0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>overall = (mval - invested if np.isfinite(mval) else 0.0) + divs</p>
<p class="p1"><span class="Apple-converted-space">            </span>ret_pct = (overall / invested * 100) if invested &gt; 0 else np.nan</p>
<p class="p1"><span class="Apple-converted-space">            </span>payout = fetch_dividend_frequency(tkr)</p>
<p class="p1"><span class="Apple-converted-space">            </span>true_ada = ((invested - divs) / shares) if shares &gt; 0 else np.nan</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>rows.append(</p>
<p class="p1"><span class="Apple-converted-space">                </span>{</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Ticker": tkr,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Name": rec.get("name", ""),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Payout Freq": payout,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Shares": round(shares, 6),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Purchase Price": rec.get("purchase_price", np.nan),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Total Invested": invested,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Price Now": price,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Current Value": mval,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Dividends Collected": divs,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"True ADA": true_ada,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Overall Return $": overall,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Overall Return %": ret_pct,</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if np.isfinite(mval):</p>
<p class="p1"><span class="Apple-converted-space">                </span>total_value += mval</p>
<p class="p1"><span class="Apple-converted-space">            </span>total_invested += invested</p>
<p class="p1"><span class="Apple-converted-space">            </span>total_div += divs</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>order = [</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Ticker",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Name",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Payout Freq",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Shares",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Purchase Price",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Total Invested",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Price Now",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Current Value",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Dividends Collected",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"True ADA",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Overall Return $",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Overall Return %",</p>
<p class="p1"><span class="Apple-converted-space">        </span>]</p>
<p class="p1"><span class="Apple-converted-space">        </span>df = pd.DataFrame(rows)[order]</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>money_cols = [</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Purchase Price",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Total Invested",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Price Now",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Current Value",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Dividends Collected",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"True ADA",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Overall Return $",</p>
<p class="p1"><span class="Apple-converted-space">        </span>]</p>
<p class="p1"><span class="Apple-converted-space">        </span>pct_cols = ["Overall Return %"]</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>sty = (</p>
<p class="p1"><span class="Apple-converted-space">            </span>df.style.format({**{c: money_fmt for c in money_cols}, **{c: pct_fmt for c in pct_cols}})</p>
<p class="p1"><span class="Apple-converted-space">            </span>.applymap(color_pos_neg, subset=["Overall Return $", "Overall Return %"])</p>
<p class="p1"><span class="Apple-converted-space">            </span>.set_properties(subset=money_cols + pct_cols, **{"text-align": "right"})</p>
<p class="p1"><span class="Apple-converted-space">            </span>.set_table_styles(stripe())</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>try:</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.dataframe(sty, use_container_width=True, height=600, hide_index=True)</p>
<p class="p1"><span class="Apple-converted-space">        </span>except TypeError:</p>
<p class="p1"><span class="Apple-converted-space">            </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.dataframe(sty.hide(axis="index"), use_container_width=True, height=600)</p>
<p class="p1"><span class="Apple-converted-space">            </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">                </span># Fallback: pre-format the DataFrame</p>
<p class="p1"><span class="Apple-converted-space">                </span>df_display = df.copy()</p>
<p class="p1"><span class="Apple-converted-space">                </span>for c in money_cols:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>df_display[c] = df_display[c].apply(money_fmt)</p>
<p class="p1"><span class="Apple-converted-space">                </span>for c in pct_cols:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>df_display[c] = df_display[c].apply(pct_fmt)</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.dataframe(df_display, use_container_width=True, height=600)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>cash = float(DATA.get("cash_uninvested", 0))</p>
<p class="p1"><span class="Apple-converted-space">        </span>overall = (total_value - total_invested) + total_div</p>
<p class="p1"><span class="Apple-converted-space">        </span>overall_pct = (overall / total_invested * 100) if total_invested &gt; 0 else np.nan</p>
<p class="p1"><span class="Apple-converted-space">        </span>total_value_incl_cash = total_value + cash</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>c1, c2, c3, c4, c5 = st.columns(5)</p>
<p class="p1"><span class="Apple-converted-space">        </span>c1.metric("Total Invested", money_str(total_invested))</p>
<p class="p1"><span class="Apple-converted-space">        </span>c2.metric("Current Value (Holdings)", money_str(total_value))</p>
<p class="p1"><span class="Apple-converted-space">        </span>c3.metric("Cash Available", money_str(cash))</p>
<p class="p1"><span class="Apple-converted-space">        </span>c4.metric("Total Value (incl. Cash)", money_str(total_value_incl_cash))</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>color = (</p>
<p class="p1"><span class="Apple-converted-space">            </span>"#16a34a"</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (np.isfinite(overall) and overall &gt; 0)</p>
<p class="p1"><span class="Apple-converted-space">            </span>else ("#dc2626" if (np.isfinite(overall) and overall &lt; 0) else "#374151")</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>pct_txt = f"{overall_pct:.2f}%" if np.isfinite(overall_pct) else "—"</p>
<p class="p1"><span class="Apple-converted-space">        </span>c5.markdown(</p>
<p class="p1"><span class="Apple-converted-space">            </span>f"""</p>
<p class="p1">&lt;div style="border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div style="font-size:12px;color:#6b7280;"&gt;Overall Return&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div style="font-size:22px;font-weight:700;color:{color};"&gt;{money_str(overall)}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div style="font-size:12px;color:#6b7280;"&gt;{pct_txt}&lt;/div&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p1">""",</p>
<p class="p1"><span class="Apple-converted-space">            </span>unsafe_allow_html=True,</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>st.markdown("---")</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.subheader("Cash Available")</p>
<p class="p1"><span class="Apple-converted-space">        </span>new_cash = money_input(</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Cash Available",</p>
<p class="p1"><span class="Apple-converted-space">            </span>key="cash_available_main",</p>
<p class="p1"><span class="Apple-converted-space">            </span>value=float(DATA.get("cash_uninvested", 0.0)),</p>
<p class="p1"><span class="Apple-converted-space">            </span>help="This is included in Total Value (incl. Cash).",</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>if st.button("Save Cash Available"):</p>
<p class="p1"><span class="Apple-converted-space">            </span>DATA["cash_uninvested"] = float(new_cash)</p>
<p class="p1"><span class="Apple-converted-space">            </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.success("Cash Available saved.")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if DATA.get("last_updated"):</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.caption(f"Last price update: {DATA['last_updated']}")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>st.markdown("---")</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.subheader("Ticker Summaries")</p>
<p class="p1"><span class="Apple-converted-space">        </span>for tkr, rec in sorted(DATA["holdings"].items()):</p>
<p class="p1"><span class="Apple-converted-space">            </span>with st.expander(f"{tkr} — {rec.get('name','')}"):</p>
<p class="p1"><span class="Apple-converted-space">                </span>summary = rec.get("summary", "")</p>
<p class="p1"><span class="Apple-converted-space">                </span>if not summary:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>nm, sm = fetch_name_and_summary(tkr)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if not rec.get("name"):</p>
<p class="p1"><span class="Apple-converted-space">                        </span>rec["name"] = nm</p>
<p class="p1"><span class="Apple-converted-space">                    </span>rec["summary"] = sm</p>
<p class="p1"><span class="Apple-converted-space">                    </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>summary = sm</p>
<p class="p1"><span class="Apple-converted-space">                </span>if summary:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>st.write(summary)</p>
<p class="p1"><span class="Apple-converted-space">                </span>payout = fetch_dividend_frequency(tkr)</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.markdown(f"- **Dividend Payout Frequency:** {payout}")</p>
<p class="p2"><br></p>
<p class="p1"># ---- Add Holding ----</p>
<p class="p1">with tab_add:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("Add Holding")</p>
<p class="p1"><span class="Apple-converted-space">    </span>with st.form("add_form", clear_on_submit=True):</p>
<p class="p1"><span class="Apple-converted-space">        </span>col1, col2 = st.columns(2)</p>
<p class="p1"><span class="Apple-converted-space">        </span>ticker = col1.text_input("Ticker", placeholder="AAPL").strip().upper()</p>
<p class="p1"><span class="Apple-converted-space">        </span>name = col2.text_input("Name (auto-fills if blank)", placeholder="Apple Inc.").strip()</p>
<p class="p1"><span class="Apple-converted-space">        </span>shares = shares_input(</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Shares purchased",</p>
<p class="p1"><span class="Apple-converted-space">            </span>key="add_shares",</p>
<p class="p1"><span class="Apple-converted-space">            </span>help="Supports up to 6 decimals (e.g., 100.391000).",</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>purchase_price = money_input(</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Purchase price per share ($, optional)", key="add_purchase_price", value=0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>total_invested = money_input(</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Total invested",</p>
<p class="p1"><span class="Apple-converted-space">            </span>key="add_total_invested",</p>
<p class="p1"><span class="Apple-converted-space">            </span>value=0.0,</p>
<p class="p1"><span class="Apple-converted-space">            </span>help="Include fees/commissions if applicable.",</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>dividends = money_input(</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Dividends collected so far", key="add_dividends", value=0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>submitted = st.form_submit_button("Add Holding")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if submitted:</p>
<p class="p1"><span class="Apple-converted-space">        </span>if not ticker or shares &lt;= 0 or total_invested &lt;= 0:</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.error("Please enter at least Ticker, Shares &gt; 0, and Total invested &gt; 0.")</p>
<p class="p1"><span class="Apple-converted-space">        </span>else:</p>
<p class="p1"><span class="Apple-converted-space">            </span>auto_name, auto_summary = (</p>
<p class="p1"><span class="Apple-converted-space">                </span>fetch_name_and_summary(ticker) if not name else (name, "")</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>if ticker in DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.warning("Ticker already exists. Use Edit tab to modify existing holding.")</p>
<p class="p1"><span class="Apple-converted-space">            </span>else:</p>
<p class="p1"><span class="Apple-converted-space">                </span>DATA["holdings"][ticker] = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"name": auto_name,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"shares": float(shares),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"total_invested": float(total_invested),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"purchase_price": float(purchase_price) if purchase_price &gt; 0 else None,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"dividends_collected": float(dividends),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"summary": auto_summary,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"last_div_amount": 0.0,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"last_div_date": "",</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"created": datetime.now().isoformat(timespec="seconds"),</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.success(f"Added {ticker} — {auto_name}")</p>
<p class="p2"><br></p>
<p class="p1"># ---- Edit Holdings ----</p>
<p class="p1">with tab_edit:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("Edit / Update Holdings")</p>
<p class="p1"><span class="Apple-converted-space">    </span>if not DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.info("Nothing to edit yet.")</p>
<p class="p1"><span class="Apple-converted-space">    </span>else:</p>
<p class="p1"><span class="Apple-converted-space">        </span>all_tickers = sorted(list(DATA["holdings"].keys()))</p>
<p class="p1"><span class="Apple-converted-space">        </span>sel = st.selectbox("Select ticker", options=all_tickers)</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec = DATA["holdings"][sel]</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>with st.form("edit_form"):</p>
<p class="p1"><span class="Apple-converted-space">            </span>name = st.text_input("Name", value=rec.get("name", ""))</p>
<p class="p1"><span class="Apple-converted-space">            </span>shares = shares_input(</p>
<p class="p1"><span class="Apple-converted-space">                </span>"Shares",</p>
<p class="p1"><span class="Apple-converted-space">                </span>key=f"edit_shares_{sel}",</p>
<p class="p1"><span class="Apple-converted-space">                </span>value=float(rec.get("shares", 0)),</p>
<p class="p1"><span class="Apple-converted-space">                </span>help="Supports up to 6 decimals.",</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>total_invested = money_input(</p>
<p class="p1"><span class="Apple-converted-space">                </span>"Total invested",</p>
<p class="p1"><span class="Apple-converted-space">                </span>key=f"edit_total_invested_{sel}",</p>
<p class="p1"><span class="Apple-converted-space">                </span>value=float(rec.get("total_invested", 0)),</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>purchase_price = money_input(</p>
<p class="p1"><span class="Apple-converted-space">                </span>"Purchase price per share ($, optional)",</p>
<p class="p1"><span class="Apple-converted-space">                </span>key=f"edit_purchase_price_{sel}",</p>
<p class="p1"><span class="Apple-converted-space">                </span>value=float(rec.get("purchase_price") or 0.0),</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>dividends = money_input(</p>
<p class="p1"><span class="Apple-converted-space">                </span>"Dividends collected so far",</p>
<p class="p1"><span class="Apple-converted-space">                </span>key=f"edit_div_{sel}",</p>
<p class="p1"><span class="Apple-converted-space">                </span>value=float(rec.get("dividends_collected", 0.0)),</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>summary = st.text_area(</p>
<p class="p1"><span class="Apple-converted-space">                </span>"Summary (auto-fetched; you can edit)",</p>
<p class="p1"><span class="Apple-converted-space">                </span>value=rec.get("summary", ""),</p>
<p class="p1"><span class="Apple-converted-space">                </span>height=120,</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>save_btn = st.form_submit_button("Save changes")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if save_btn:</p>
<p class="p1"><span class="Apple-converted-space">            </span>DATA["holdings"][sel] = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>**rec,</p>
<p class="p1"><span class="Apple-converted-space">                </span>"name": name,</p>
<p class="p1"><span class="Apple-converted-space">                </span>"shares": float(shares),</p>
<p class="p1"><span class="Apple-converted-space">                </span>"total_invested": float(total_invested),</p>
<p class="p1"><span class="Apple-converted-space">                </span>"purchase_price": float(purchase_price) if purchase_price &gt; 0 else None,</p>
<p class="p1"><span class="Apple-converted-space">                </span>"dividends_collected": float(dividends),</p>
<p class="p1"><span class="Apple-converted-space">                </span>"summary": summary,</p>
<p class="p1"><span class="Apple-converted-space">                </span>"updated": datetime.now().isoformat(timespec="seconds"),</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.success(f"Updated {sel}.")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>with st.expander("🗑️ Delete Holding"):</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.caption("This permanently removes the selected holding from your portfolio data.")</p>
<p class="p1"><span class="Apple-converted-space">            </span>col_a, col_b = st.columns([1, 1])</p>
<p class="p1"><span class="Apple-converted-space">            </span>confirm = col_a.checkbox(f"Yes, delete {sel}")</p>
<p class="p1"><span class="Apple-converted-space">            </span>if col_b.button("Delete Holding", disabled=not confirm, type="secondary"):</p>
<p class="p1"><span class="Apple-converted-space">                </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>del DATA["holdings"][sel]</p>
<p class="p1"><span class="Apple-converted-space">                    </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>st.success(f"Deleted {sel}. Refreshing…")</p>
<p class="p1"><span class="Apple-converted-space">                    </span>st.rerun()</p>
<p class="p1"><span class="Apple-converted-space">                </span>except KeyError:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>st.error("Ticker not found.")</p>
<p class="p2"><br></p>
<p class="p1"># ---- Dividends ----</p>
<p class="p1">with tab_div:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("Quick Dividend Entry (with last amount &amp; date)")</p>
<p class="p1"><span class="Apple-converted-space">    </span>if not DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.info("Add a holding first.")</p>
<p class="p1"><span class="Apple-converted-space">    </span>else:</p>
<p class="p1"><span class="Apple-converted-space">        </span>tickers = sorted(list(DATA["holdings"].keys()))</p>
<p class="p1"><span class="Apple-converted-space">        </span>col1, col2, col3, col4 = st.columns([1, 1, 1, 1])</p>
<p class="p1"><span class="Apple-converted-space">        </span>sel = col1.selectbox("Ticker", options=tickers)</p>
<p class="p1"><span class="Apple-converted-space">        </span>dflt_date = date.today()</p>
<p class="p1"><span class="Apple-converted-space">        </span>dt = col2.date_input("Dividend date", value=dflt_date, key=f"div_date_{sel}")</p>
<p class="p1"><span class="Apple-converted-space">        </span>amt = col3.text_input("Dividend amount to add", value="$0.00", key=f"div_amt_{sel}")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>def _money_to_float(s):</p>
<p class="p1"><span class="Apple-converted-space">            </span>s = str(s).strip().replace(",", "").replace("$", "")</p>
<p class="p1"><span class="Apple-converted-space">            </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                </span>return float(s) if s else 0.0</p>
<p class="p1"><span class="Apple-converted-space">            </span>except:</p>
<p class="p1"><span class="Apple-converted-space">                </span>return 0.0</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if col4.button("Add dividend"):</p>
<p class="p1"><span class="Apple-converted-space">            </span>add_val = _money_to_float(amt)</p>
<p class="p1"><span class="Apple-converted-space">            </span>DATA["holdings"][sel]["dividends_collected"] = float(</p>
<p class="p1"><span class="Apple-converted-space">                </span>DATA["holdings"][sel].get("dividends_collected", 0.0)</p>
<p class="p1"><span class="Apple-converted-space">            </span>) + add_val</p>
<p class="p1"><span class="Apple-converted-space">            </span>DATA["holdings"][sel]["last_div_amount"] = add_val</p>
<p class="p1"><span class="Apple-converted-space">            </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                </span>DATA["holdings"][sel]["last_div_date"] = dt.isoformat()</p>
<p class="p1"><span class="Apple-converted-space">            </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">                </span>DATA["holdings"][sel]["last_div_date"] = str(dt)</p>
<p class="p1"><span class="Apple-converted-space">            </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.success(f"Added {money_str(add_val)} dividend to {sel} for {dt}.")</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>rows = []</p>
<p class="p1"><span class="Apple-converted-space">        </span>total = 0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>for tkr, rec in sorted(DATA["holdings"].items()):</p>
<p class="p1"><span class="Apple-converted-space">            </span>d = float(rec.get("dividends_collected", 0.0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>last_amt = float(rec.get("last_div_amount", 0.0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>last_dt = rec.get("last_div_date", "")</p>
<p class="p1"><span class="Apple-converted-space">            </span>rows.append(</p>
<p class="p1"><span class="Apple-converted-space">                </span>{</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Ticker": tkr,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Dividends Collected": d,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Last Dividend $": last_amt,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Last Dividend Date": last_dt,</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>total += d</p>
<p class="p1"><span class="Apple-converted-space">        </span>df_div = pd.DataFrame(rows).reset_index(drop=True)</p>
<p class="p1"><span class="Apple-converted-space">        </span>df_div["Dividends Collected"] = df_div["Dividends Collected"].apply(lambda v: f"${float(v):,.2f}")</p>
<p class="p1"><span class="Apple-converted-space">        </span>df_div["Last Dividend $"] = df_div["Last Dividend $"].apply(lambda v: f"${float(v):,.2f}" if v else "")</p>
<p class="p1"><span class="Apple-converted-space">        </span>try:</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.dataframe(</p>
<p class="p1"><span class="Apple-converted-space">                </span>df_div.style.set_table_styles(stripe()),</p>
<p class="p1"><span class="Apple-converted-space">                </span>use_container_width=True,</p>
<p class="p1"><span class="Apple-converted-space">                </span>height=360,</p>
<p class="p1"><span class="Apple-converted-space">                </span>hide_index=True,</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>except TypeError:</p>
<p class="p1"><span class="Apple-converted-space">            </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.dataframe(</p>
<p class="p1"><span class="Apple-converted-space">                    </span>df_div.style.hide(axis="index").set_table_styles(stripe()),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>use_container_width=True,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>height=360,</p>
<p class="p1"><span class="Apple-converted-space">                </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.dataframe(df_div, use_container_width=True, height=360)</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.metric("Total Dividends Collected", money_str(total))</p>
<p class="p2"><br></p>
<p class="p1"># ---- True ADA ----</p>
<p class="p1">with tab_trueada:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("True Adjusted Dividend Average (True ADA)")</p>
<p class="p1"><span class="Apple-converted-space">    </span>if not DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.info("Add a holding first to calculate True ADA.")</p>
<p class="p1"><span class="Apple-converted-space">    </span>else:</p>
<p class="p1"><span class="Apple-converted-space">        </span>rows = []</p>
<p class="p1"><span class="Apple-converted-space">        </span>sum_shares = 0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>sum_invested = 0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>sum_div = 0.0</p>
<p class="p1"><span class="Apple-converted-space">        </span>for tkr, rec in sorted(DATA["holdings"].items()):</p>
<p class="p1"><span class="Apple-converted-space">            </span>shares = float(rec.get("shares", 0.0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>invested = float(rec.get("total_invested", 0.0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>divs = float(rec.get("dividends_collected", 0.0))</p>
<p class="p1"><span class="Apple-converted-space">            </span>true_ada = (invested - divs) / shares if shares &gt; 0 else np.nan</p>
<p class="p1"><span class="Apple-converted-space">            </span>price = fetch_price(tkr) if DATA["settings"].get("auto_price", True) else float("nan")</p>
<p class="p1"><span class="Apple-converted-space">            </span>if np.isnan(price):</p>
<p class="p1"><span class="Apple-converted-space">                </span>price = float(DATA["last_prices"].get(tkr, np.nan))</p>
<p class="p1"><span class="Apple-converted-space">            </span>vs_true_pct = (</p>
<p class="p1"><span class="Apple-converted-space">                </span>(price - true_ada) / true_ada * 100.0</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (shares &gt; 0 and np.isfinite(price) and np.isfinite(true_ada) and true_ada != 0)</p>
<p class="p1"><span class="Apple-converted-space">                </span>else np.nan</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>rows.append(</p>
<p class="p1"><span class="Apple-converted-space">                </span>{</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Ticker": tkr,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Shares": round(shares, 6),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Total Invested": invested,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Dividends Collected": divs,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"True ADA": true_ada,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Current Price": price if np.isfinite(price) else np.nan,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"Return vs True ADA %": vs_true_pct,</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>sum_shares += shares</p>
<p class="p1"><span class="Apple-converted-space">            </span>sum_invested += invested</p>
<p class="p1"><span class="Apple-converted-space">            </span>sum_div += divs</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>df = pd.DataFrame(rows)</p>
<p class="p1"><span class="Apple-converted-space">        </span>df_disp = df.copy()</p>
<p class="p1"><span class="Apple-converted-space">        </span>for c in ["Total Invested", "Dividends Collected", "True ADA", "Current Price"]:</p>
<p class="p1"><span class="Apple-converted-space">            </span>df_disp[c] = df_disp[c].apply(lambda v: "" if pd.isna(v) else f"${float(v):,.2f}")</p>
<p class="p1"><span class="Apple-converted-space">        </span>df_disp["Return vs True ADA %"] = df_disp["Return vs True ADA %"].apply(</p>
<p class="p1"><span class="Apple-converted-space">            </span>lambda v: "" if pd.isna(v) else f"{float(v):,.2f}%"</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>def color_pct(v):</p>
<p class="p1"><span class="Apple-converted-space">            </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                </span>x = float(str(v).replace("%", ""))</p>
<p class="p1"><span class="Apple-converted-space">            </span>except:</p>
<p class="p1"><span class="Apple-converted-space">                </span>return ""</p>
<p class="p1"><span class="Apple-converted-space">            </span>if not np.isfinite(x):</p>
<p class="p1"><span class="Apple-converted-space">                </span>return ""</p>
<p class="p1"><span class="Apple-converted-space">            </span>if x &gt; 0:</p>
<p class="p1"><span class="Apple-converted-space">                </span>return "color:#16a34a;"</p>
<p class="p1"><span class="Apple-converted-space">            </span>if x &lt; 0:</p>
<p class="p1"><span class="Apple-converted-space">                </span>return "color:#dc2626;"</p>
<p class="p1"><span class="Apple-converted-space">            </span>return ""</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>try:</p>
<p class="p1"><span class="Apple-converted-space">            </span>sty = (</p>
<p class="p1"><span class="Apple-converted-space">                </span>df_disp.style.applymap(color_pct, subset=["Return vs True ADA %"])</p>
<p class="p1"><span class="Apple-converted-space">                </span>.set_properties(</p>
<p class="p1"><span class="Apple-converted-space">                    </span>subset=["Total Invested", "Dividends Collected", "True ADA", "Current Price", "Return vs True ADA %"],</p>
<p class="p1"><span class="Apple-converted-space">                    </span>**{"text-align": "right"},</p>
<p class="p1"><span class="Apple-converted-space">                </span>)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.set_table_styles(stripe())</p>
<p class="p1"><span class="Apple-converted-space">            </span>)</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.dataframe(sty, use_container_width=True, height=520, hide_index=True)</p>
<p class="p1"><span class="Apple-converted-space">        </span>except TypeError:</p>
<p class="p1"><span class="Apple-converted-space">            </span>try:</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.dataframe(sty.hide(axis="index"), use_container_width=True, height=520)</p>
<p class="p1"><span class="Apple-converted-space">            </span>except Exception:</p>
<p class="p1"><span class="Apple-converted-space">                </span>st.dataframe(df_disp, use_container_width=True, height=520)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if sum_shares &gt; 0:</p>
<p class="p1"><span class="Apple-converted-space">            </span>avg_cost_portfolio = (sum_invested / sum_shares)</p>
<p class="p1"><span class="Apple-converted-space">            </span>true_ada_portfolio = ((sum_invested - sum_div) / sum_shares)</p>
<p class="p1"><span class="Apple-converted-space">            </span>improvement_pct = ((avg_cost_portfolio - true_ada_portfolio) / avg_cost_portfolio * 100.0) if avg_cost_portfolio &gt; 0 else np.nan</p>
<p class="p1"><span class="Apple-converted-space">        </span>else:</p>
<p class="p1"><span class="Apple-converted-space">            </span>avg_cost_portfolio = np.nan</p>
<p class="p1"><span class="Apple-converted-space">            </span>true_ada_portfolio = np.nan</p>
<p class="p1"><span class="Apple-converted-space">            </span>improvement_pct = np.nan</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>c1, c2, c3, c4 = st.columns(4)</p>
<p class="p1"><span class="Apple-converted-space">        </span>c1.metric("Total Dividends Collected", f"${sum_div:,.2f}")</p>
<p class="p1"><span class="Apple-converted-space">        </span>c2.metric("Unadjusted Avg Cost (Portfolio)", f"${avg_cost_portfolio:,.2f}" if np.isfinite(avg_cost_portfolio) else "—")</p>
<p class="p1"><span class="Apple-converted-space">        </span>c3.metric("True ADA (Portfolio)", f"${true_ada_portfolio:,.2f}" if np.isfinite(true_ada_portfolio) else "—")</p>
<p class="p1"><span class="Apple-converted-space">        </span>c4.metric("Adjusted Basis Improvement", f"{improvement_pct:.2f}%" if np.isfinite(improvement_pct) else "—")</p>
<p class="p2"><br></p>
<p class="p1"># ---- Migration ----</p>
<p class="p1">with tab_migrate:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("Migrate from older version")</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.caption("Import/merge a previous `portfolio_data.json` without losing your data.")</p>
<p class="p1"><span class="Apple-converted-space">    </span>upl = st.file_uploader("Choose previous JSON file", type=["json"])</p>
<p class="p1"><span class="Apple-converted-space">    </span>merge_mode = st.radio("Merge strategy", ["Add new tickers only", "Overwrite existing tickers with incoming data"])</p>
<p class="p1"><span class="Apple-converted-space">    </span>if upl is not None and st.button("Merge now"):</p>
<p class="p1"><span class="Apple-converted-space">        </span>try:</p>
<p class="p1"><span class="Apple-converted-space">            </span>incoming = json.load(upl)</p>
<p class="p1"><span class="Apple-converted-space">            </span>inc_holdings = incoming.get("holdings", {})</p>
<p class="p1"><span class="Apple-converted-space">            </span>added = 0</p>
<p class="p1"><span class="Apple-converted-space">            </span>updated = 0</p>
<p class="p1"><span class="Apple-converted-space">            </span>for tkr, rec in inc_holdings.items():</p>
<p class="p1"><span class="Apple-converted-space">                </span>rec.setdefault("last_div_amount", 0.0)</p>
<p class="p1"><span class="Apple-converted-space">                </span>rec.setdefault("last_div_date", "")</p>
<p class="p1"><span class="Apple-converted-space">                </span>if tkr not in DATA["holdings"]:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DATA["holdings"][tkr] = rec</p>
<p class="p1"><span class="Apple-converted-space">                    </span>added += 1</p>
<p class="p1"><span class="Apple-converted-space">                </span>else:</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if merge_mode.startswith("Overwrite"):</p>
<p class="p1"><span class="Apple-converted-space">                        </span>DATA["holdings"][tkr] = rec</p>
<p class="p1"><span class="Apple-converted-space">                        </span>updated += 1</p>
<p class="p1"><span class="Apple-converted-space">            </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.success(f"Merged successfully. Added: {added}, Updated: {updated}.")</p>
<p class="p1"><span class="Apple-converted-space">        </span>except Exception as e:</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.error(f"Failed to merge: {e}")</p>
<p class="p2"><br></p>
<p class="p1"># ---- Backup ----</p>
<p class="p1">with tab_backup:</p>
<p class="p1"><span class="Apple-converted-space">    </span>st.subheader("Backup &amp; Restore")</p>
<p class="p1"><span class="Apple-converted-space">    </span>with open(DATA_FILE, "rb") as f:</p>
<p class="p1"><span class="Apple-converted-space">        </span>st.download_button(</p>
<p class="p1"><span class="Apple-converted-space">            </span>"⬇️ Download backup (JSON)",</p>
<p class="p1"><span class="Apple-converted-space">            </span>data=f,</p>
<p class="p1"><span class="Apple-converted-space">            </span>file_name=f"portfolio_backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json",</p>
<p class="p1"><span class="Apple-converted-space">            </span>mime="application/json",</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">    </span>upl = st.file_uploader("Restore from JSON backup", type=["json"])</p>
<p class="p1"><span class="Apple-converted-space">    </span>if upl is not None and st.button("Restore now"):</p>
<p class="p1"><span class="Apple-converted-space">        </span>try:</p>
<p class="p1"><span class="Apple-converted-space">            </span>DATA = json.load(upl)</p>
<p class="p1"><span class="Apple-converted-space">            </span>for rec in DATA.get("holdings", {}).values():</p>
<p class="p1"><span class="Apple-converted-space">                </span>rec.setdefault("last_div_amount", 0.0)</p>
<p class="p1"><span class="Apple-converted-space">                </span>rec.setdefault("last_div_date", "")</p>
<p class="p1"><span class="Apple-converted-space">            </span>save_data(DATA)</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.success("Backup restored. Reloading…")</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.rerun()</p>
<p class="p1"><span class="Apple-converted-space">        </span>except Exception as e:</p>
<p class="p1"><span class="Apple-converted-space">            </span>st.error(f"Failed to restore: {e}")</p>
<p class="p1">`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "Start MKK Investment Tracker.command",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/x-sh",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`#!/bin/bash</p>
<p class="p1">set -e</p>
<p class="p1">cd "$(dirname "$0")"</p>
<p class="p1">if [ ! -d ".venv" ]; then</p>
<p class="p1"><span class="Apple-converted-space">  </span>/usr/bin/python3 -m venv .venv</p>
<p class="p1"><span class="Apple-converted-space">  </span>source .venv/bin/activate</p>
<p class="p1"><span class="Apple-converted-space">  </span>python -m pip install --upgrade pip</p>
<p class="p1"><span class="Apple-converted-space">  </span>pip install streamlit yfinance pandas numpy altair pydeck watchdog tornado packaging requests pytz</p>
<p class="p1">else</p>
<p class="p1"><span class="Apple-converted-space">  </span>source .venv/bin/activate</p>
<p class="p1">fi</p>
<p class="p1">exec streamlit run "tracker_app.py"`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "portfolio_data.json",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "application/json",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`{</p>
<p class="p1"><span class="Apple-converted-space">  </span>"holdings": {},</p>
<p class="p1"><span class="Apple-converted-space">  </span>"cash_uninvested": 0.0,</p>
<p class="p1"><span class="Apple-converted-space">  </span>"settings": { "currency": "USD", "auto_price": true },</p>
<p class="p1"><span class="Apple-converted-space">  </span>"last_prices": {},</p>
<p class="p1"><span class="Apple-converted-space">  </span>"last_updated": null,</p>
<p class="p1"><span class="Apple-converted-space">  </span>"version": "1.8.9c"</p>
<p class="p1">}`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "README.txt",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/plain",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`MKK Investment Tracker – v1.8.9c</p>
<p class="p2"><br></p>
<p class="p1">Usage:</p>
<p class="p1">1) Double-click “Start MKK Investment Tracker.command”</p>
<p class="p1">2) App launches in your browser (Streamlit)</p>
<p class="p1">3) Data is saved at:</p>
<p class="p1"><span class="Apple-converted-space">   </span>- macOS: ~/Library/Application Support/MKK Investment Tracker/portfolio_data.json</p>
<p class="p1"><span class="Apple-converted-space">   </span>- Streamlit Cloud: ./data/portfolio_data.json (container)</p>
<p class="p2"><br></p>
<p class="p1">Features:</p>
<p class="p1">- Color-coded Overall Return ($/%)</p>
<p class="p1">- True ADA view with color-coded % vs True ADA</p>
<p class="p1">- Subtle row striping in tables</p>
<p class="p1">- Dividend quick entry (amount + date)</p>
<p class="p1">- Delete Holding, Migration, Backup/Restore`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "requirements.txt",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/plain",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`streamlit&gt;=1.33</p>
<p class="p1">yfinance&gt;=0.2.40</p>
<p class="p1">pandas&gt;=2.2</p>
<p class="p1">numpy&gt;=1.26</p>
<p class="p1">altair&gt;=5.3</p>
<p class="p1">pydeck&gt;=0.9</p>
<p class="p1">watchdog&gt;=4.0</p>
<p class="p1">packaging&gt;=24.0</p>
<p class="p1">requests&gt;=2.31</p>
<p class="p1">pytz&gt;=2024.1`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "runtime.txt",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/plain",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: "3.11\n"</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: ".streamlit/config.toml",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/plain",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`[theme]</p>
<p class="p1">base="light"</p>
<p class="p1">primaryColor="#1f6feb"</p>
<p class="p1">backgroundColor="#ffffff"</p>
<p class="p1">secondaryBackgroundColor="#f6f8fa"</p>
<p class="p1">textColor="#111827"`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: ".gitignore",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/plain",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`__pycache__/</p>
<p class="p1">*.pyc</p>
<p class="p1">.venv/</p>
<p class="p1">env/</p>
<p class="p1">.DS_Store</p>
<p class="p1">.streamlit/secrets.toml`</p>
<p class="p1"><span class="Apple-converted-space">  </span>},</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">    </span>name: "build_mkk_dmg.sh",</p>
<p class="p1"><span class="Apple-converted-space">    </span>mime: "text/x-sh",</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: String.raw`#!/bin/bash</p>
<p class="p1">set -euo pipefail</p>
<p class="p2"><br></p>
<p class="p1">APP_NAME="MKK Investment Tracker"</p>
<p class="p1">BUNDLE_ID="com.mkk.investmenttracker"</p>
<p class="p1">VERSION="${1:-1.8.9}"</p>
<p class="p2"><br></p>
<p class="p1"># 1) Dependencies</p>
<p class="p1">if ! command -v platypus &gt;/dev/null 2&gt;&amp;1; then</p>
<p class="p1"><span class="Apple-converted-space">  </span>echo "Platypus not found. Installing via Homebrew..."</p>
<p class="p1"><span class="Apple-converted-space">  </span>if ! command -v brew &gt;/dev/null 2&gt;&amp;1; then</p>
<p class="p1"><span class="Apple-converted-space">    </span>echo "Homebrew is required. Install from https://brew.sh"</p>
<p class="p1"><span class="Apple-converted-space">    </span>exit 1</p>
<p class="p1"><span class="Apple-converted-space">  </span>fi</p>
<p class="p1"><span class="Apple-converted-space">  </span>brew install --cask platypus</p>
<p class="p1">fi</p>
<p class="p2"><br></p>
<p class="p1"># 2) Check hdiutil (macOS built-in)</p>
<p class="p1">if ! command -v hdiutil &gt;/dev/null 2&gt;&amp;1; then</p>
<p class="p1"><span class="Apple-converted-space">  </span>echo "hdiutil not found; must run on macOS."</p>
<p class="p1"><span class="Apple-converted-space">  </span>exit 1</p>
<p class="p1">fi</p>
<p class="p2"><br></p>
<p class="p1"># 3) Build icon.icns from icon.png</p>
<p class="p1">ICON_PNG="icon.png"</p>
<p class="p1">if [ ! -f "$ICON_PNG" ]; then echo "Missing icon.png"; exit 1; fi</p>
<p class="p2"><br></p>
<p class="p1">echo "Generating icon.icns..."</p>
<p class="p1">rm -rf icon.iconset icon.icns</p>
<p class="p1">mkdir icon.iconset</p>
<p class="p1">sips -z 16 16 <span class="Apple-converted-space">    </span>"$ICON_PNG" --out icon.iconset/icon_16x16.png &gt;/dev/null</p>
<p class="p1">sips -z 32 32 <span class="Apple-converted-space">    </span>"$ICON_PNG" --out icon.iconset/icon_16x16@2x.png &gt;/dev/null</p>
<p class="p1">sips -z 32 32 <span class="Apple-converted-space">    </span>"$ICON_PNG" --out icon.iconset/icon_32x32.png &gt;/dev/null</p>
<p class="p1">sips -z 64 64 <span class="Apple-converted-space">    </span>"$ICON_PNG" --out icon.iconset/icon_32x32@2x.png &gt;/dev/null</p>
<p class="p1">sips -z 128 128 <span class="Apple-converted-space">  </span>"$ICON_PNG" --out icon.iconset/icon_128x128.png &gt;/dev/null</p>
<p class="p1">sips -z 256 256 <span class="Apple-converted-space">  </span>"$ICON_PNG" --out icon.iconset/icon_128x128@2x.png &gt;/dev/null</p>
<p class="p1">sips -z 256 256 <span class="Apple-converted-space">  </span>"$ICON_PNG" --out icon.iconset/icon_256x256.png &gt;/dev/null</p>
<p class="p1">sips -z 512 512 <span class="Apple-converted-space">  </span>"$ICON_PNG" --out icon.iconset/icon_256x256@2x.png &gt;/dev/null</p>
<p class="p1">sips -z 512 512 <span class="Apple-converted-space">  </span>"$ICON_PNG" --out icon.iconset/icon_512x512.png &gt;/dev/null</p>
<p class="p1">cp "$ICON_PNG" icon.iconset/icon_512x512@2x.png</p>
<p class="p1">iconutil -c icns icon.iconset -o icon.icns</p>
<p class="p2"><br></p>
<p class="p1"># 4) Ensure launcher is executable</p>
<p class="p1">chmod +x "MKK_Payload/Start MKK Investment Tracker.command"</p>
<p class="p2"><br></p>
<p class="p1"># 5) Build .app with Platypus</p>
<p class="p1">APP_BUNDLE="${APP_NAME}.app"</p>
<p class="p1">rm -rf "$APP_BUNDLE"</p>
<p class="p1">platypus -y \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-a "$APP_NAME" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-o "None" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-p "/bin/bash" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-V "$VERSION" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-I "$BUNDLE_ID" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-i icon.icns \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-f "MKK_Payload/tracker_app.py" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-f "MKK_Payload/portfolio_data.json" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-f "MKK_Payload/README.txt" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>-R "MKK_Payload/Start MKK Investment Tracker.command" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>"MKK_Payload/Start MKK Investment Tracker.command" \</p>
<p class="p1"><span class="Apple-converted-space">  </span>"$APP_BUNDLE"</p>
<p class="p2"><br></p>
<p class="p1"># 6) Create DMG</p>
<p class="p1">DMG_NAME="${APP_NAME// /_}_${VERSION}.dmg"</p>
<p class="p1">rm -f "$DMG_NAME"</p>
<p class="p1">WORKDIR="$(mktemp -d)"</p>
<p class="p1">mkdir -p "$WORKDIR/mount"</p>
<p class="p1">cp -R "$APP_BUNDLE" "$WORKDIR/mount/"</p>
<p class="p1">ln -s /Applications "$WORKDIR/mount/Applications"</p>
<p class="p1">hdiutil create "$DMG_NAME" -volname "$APP_NAME" -srcfolder "$WORKDIR/mount" -ov -format UDZO &gt;/dev/null</p>
<p class="p1">rm -rf "$WORKDIR"</p>
<p class="p2"><br></p>
<p class="p1">echo "DMG created: $DMG_NAME"`</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">];</p>
<p class="p2"><br></p>
<p class="p1">/* ---------- UI rendering ---------- */</p>
<p class="p2"><br></p>
<p class="p1">function createFileCard(file){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const wrap = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrap.className = 'file';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const head = document.createElement('header');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const h2 = document.createElement('h2');</p>
<p class="p1"><span class="Apple-converted-space">  </span>h2.textContent = file.name;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const btns = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const btn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">  </span>btn.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">  </span>btn.textContent = 'Download';</p>
<p class="p1"><span class="Apple-converted-space">  </span>btn.onclick = () =&gt; download(file.name, file.content, file.mime);</p>
<p class="p1"><span class="Apple-converted-space">  </span>btns.appendChild(btn);</p>
<p class="p1"><span class="Apple-converted-space">  </span>head.appendChild(h2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>head.appendChild(btns);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const pre = document.createElement('pre');</p>
<p class="p1"><span class="Apple-converted-space">  </span>pre.className = 'code';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const code = document.createElement('code');</p>
<p class="p1"><span class="Apple-converted-space">  </span>code.textContent = file.content;</p>
<p class="p1"><span class="Apple-converted-space">  </span>pre.appendChild(code);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>wrap.appendChild(head);</p>
<p class="p1"><span class="Apple-converted-space">  </span>wrap.appendChild(pre);</p>
<p class="p1"><span class="Apple-converted-space">  </span>return wrap;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function download(filename, content, mime='text/plain'){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const blob = new Blob([content], {type: mime});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const a = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.href = url;</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.download = filename;</p>
<p class="p1"><span class="Apple-converted-space">  </span>document.body.appendChild(a);</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.click();</p>
<p class="p1"><span class="Apple-converted-space">  </span>setTimeout(() =&gt; { URL.revokeObjectURL(url); a.remove(); }, 0);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function downloadAll(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>FILES.forEach(f =&gt; download(f.name, f.content, f.mime));</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">const container = document.getElementById('files');</p>
<p class="p1">FILES.forEach(f =&gt; container.appendChild(createFileCard(f)));</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
